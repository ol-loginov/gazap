${param gazap.site.web.extensions.VisitorExtension eVisitor}
${param gazap.site.web.extensions.CdnExtension eCdn transient}
${set au=eCdn.server, cp=eCdn.contextPath}
${set m=eVisitor}

<section id="accountBar" class="logged-${m.logged}">
    ${if(m.logged)}
    <div class="account-name">
        <a class="username" href="${cp}${m.user.route}">
            <img src="http://www.gravatar.com/avatar/${m.user.gravatar}?s=16" alt="" width="16"
                 height="16"/>
            <span>
            ${if(m.user.name.length gt 0)}${m.user.name}
            ${else}${l18n:t('tb.menu.welcome.anonymous.name')}
            ${if}
            </span>
        </a>
    </div>
    <div class="account-menu">
        <div class="opener">
            <a class="toggler pull-right" href="#">
                <i class="glyphicon-resize-small collapse"></i>
                <i class="glyphicon-resize-full expand"></i>
            </a>
            <ul class="notification-icons unstyled">
                <li>
                    <span class="value">15</span>
                    <span class="label">друзей</span>
                </li>
                <li>
                    <span class="value">0</span>
                    <span class="label">писем</span>
                </li>
            </ul>
            <div class="clear"></div>
        </div>
        <ul class="unstyled menu-column">
            <li>
                <a href="${cp}/settings">
                    <i class="glyphicon-cog"></i>
                    ${l18n:t('accountBar.accountMenu.settings')}
                </a>
            </li>
            <li>
                <a href="${cp}/auth/logout">
                    <i class="glyphicon-plane"></i>
                    ${l18n:t('accountBar.accountMenu.logout')}
                </a>
            </li>
        </ul>
        <ul class="unstyled menu-column">
            ${if(m.user.summary.gamesCreated gt 0)}
            <li>
                <a href="${cp}${m.user.route}/games">
                    <i class="glyphicon-info-sign"></i>
                    ${l18n:t('accountBar.accountMenu.games')}
                </a>
            </li>
            ${if}
            ${if(m.user.summary.mapsCreated gt 0)}
            <li>
                <a href="${cp}${m.user.route}/maps">
                    <i class="glyphicon-flag"></i>
                    ${l18n:t('accountBar.accountMenu.maps')}
                </a>
            </li>
            ${if}
            ${if(m.user.summary.playersCreated gt 0)}
            <li>
                <a href="${cp}${m.user.route}/avatars">
                    <i class="glyphicon-info-sign"></i>
                    ${l18n:t('accountBar.accountMenu.avatars')}
                </a>
            </li>
            ${if}
        </ul>
        <div class="clear"></div>
    </div>
    <script type="text/javascript">
        $('#accountBar .account-menu .opener .toggler').click(function () {
            $('#accountBar .account-menu').toggleClass('expanded');
            return false;
        });
    </script>
    ${else}
    <h3>
        ${l18n:t('accountBar.anonymous.welcome')}
    </h3>

    <p>
        ${l18n:t('accountBar.anonymous.welcome.p', au)}
    </p>
    ${if}
</section>